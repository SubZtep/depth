var X=Object.defineProperty;var T=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var O=(e,o,t)=>o in e?X(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,F=(e,o)=>{for(var t in o||(o={}))Q.call(o,t)&&O(e,t,o[t]);if(T)for(var t of T(o))ee.call(o,t)&&O(e,t,o[t]);return e};import{A as g,ab as N,M as I,J as x,E as b,aj as te,ak as oe,al as se,d as w,am as ae,an as ne,ao as re,ap as ie,N as ce,U as k,aq as le,ar as C,as as j,u as h,q as _,c as v,at as de,au as R,av as D,aw as ue,ax as me,ay as _e,az as B,aA as A,W as G,X as fe,b as V,f as S,g as z,s as he,a as U,a0 as ve,aB as pe,aC as ye,v as p,w as E,ai as we,F as W,h as M}from"./three.61db46b8.js";import{n as ge,a as $,u as H,b as be}from"./index.c6e08072.js";import{_ as ke}from"./Title.e3a4358b.js";const Se=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],q=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]],Pe=/^\S+\.webm|mkv|mp4|avi|ogv$/;var K="/textures/no-video.png";function Ee({video:e,options:o,handler:t}){const r=g(!1),c=N({});let a;I(e)&&x(e,(l,i)=>{i&&a&&(b(r,!1),a.reset(),b(r,!0))});const m=l=>{Object.assign(c,l)},d=async l=>{const i=te(e);if(i===void 0)return Promise.reject(new Error("no video input"));if(i.readyState===i.HAVE_NOTHING)return Promise.reject(new Error("no data"));if(a===void 0)return Promise.reject(new Error("no pose detector"));await a.send({image:i},l)};return oe(async()=>{a=new window.Pose({locateFile:l=>`/pose/${l}`}),a.setOptions(F({modelComplexity:1,smoothLandmarks:!0,selfieMode:!1},o)),a.onResults(t!=null?t:m),await a.initialize(),b(r,!0)}),se(()=>{a==null||a.close()}),{results:c,detectorReady:r,estimatePose:d}}var y;(function(e){e[e.Raw=0]="Raw",e[e.Normalized=1]="Normalized"})(y||(y={}));function J(e){switch(e){case y.Raw:return"Raw";case y.Normalized:return"Normalized";default:return"Unknown"}}J(y.Normalized)+"",y.Normalized,J(y.Raw)+"",y.Raw;const Ne=w({emits:["pose"],setup(e,{emit:o}){const t=g(),r=N({showVideoTag:!0,videoDeviceId:void 0,enabled:!1}),{videoInputs:c}=ae({requestPermissions:!0}),{enabled:a,videoDeviceId:m}=ne(r),{stream:d,enabled:l}=re({audioDeviceId:!1,videoDeviceId:m});ie(a,l);const i=ce(()=>Object.fromEntries(k(c).map(s=>[ge(s.label),s.deviceId])));return x([m,d],()=>{k(t).srcObject=k(d)||null;const{estimatePose:s,detectorReady:n}=Ee({video:t,options:{modelComplexity:2},handler:u=>{o("pose",u.poseWorldLandmarks)}});le(n,async()=>{s()})}),$(s=>{s.name="\u{1F4F9} Webcam Player",s.add(r,"showVideoTag").name("Show video tag"),s.add(r,"enabled").name("Enabled webcam"),s.addReactiveSelect({target:r,propName:"videoDeviceId",options:i}).name("Device")}),(s,n)=>{const u=C("visible");return j((_(),v("video",{class:"video-border max-h-300px",ref:(f,P)=>{P.videoRef=f,I(t)&&(t.value=f)},poster:K,autoplay:"",muted:""},null,512)),[[u,h(r).showVideoTag]])}}}),xe=new de(.06,8,6);new R({color:6946815,flatShading:!0});new R({color:16711680,flatShading:!0});const L=new Map;function ze(e){L.has(e.color)||L.set(e.color,new R({color:e.color,flatShading:!0}));const o=new ue(xe,L.get(e.color));return o.castShadow=!0,o.receiveShadow=!0,e.name!==void 0&&(o.name=e.name),e.visible!==void 0&&(o.visible=e.visible),o}const Z=new D({color:14932681});new D({color:13369395});function Me(e,o=!0,t){const r=new me;t&&r.setFromPoints(t);const c=new _e(r,Z);return c.frustumCulled=!1,e!==void 0&&(c.name=e),c.visible=o,c}var Re=w({props:{keypoints:{type:Object,required:!1},position:{type:Array,default:()=>[0,0,0]},scale:{type:Number,default:1},zMulti:{type:Number,default:.5},color:{type:Number,default:16777215},flipVertical:{type:Boolean,default:!0}},setup(e){const o=new B,t=new B;t.position.fromArray(e.position);const r=(s,n)=>`${s}-${n}`,c=new Map,a=new Map;t.add(...Se.map((s,n)=>{const u=ze({name:s,color:e.color});return c.set(n,u),u}),...q.map(([s,n])=>{const u=r(s,n),f=Me(u);return a.set(u,f),f}));const m=s=>e.flipVertical?e.scale-s:s,d=s=>{s.forEach((n,u)=>{c.get(u).position.set(n.x*e.scale,m(n.y*e.scale),n.z*e.scale*e.zMulti)})},l=[new A,new A],i=s=>{q.forEach(([n,u])=>{l[0].set(s[n].x*e.scale,m(s[n].y*e.scale),s[n].z*e.scale*e.zMulti),l[1].set(s[u].x*e.scale,m(s[u].y*e.scale),s[u].z*e.scale*e.zMulti);const f=a.get(r(n,u));f.geometry.setFromPoints(l),f.material=Z})};G(()=>{o.add(t),x([()=>e.keypoints,()=>e.scale,()=>e.zMulti],()=>{e.keypoints!==void 0?(d(e.keypoints),i(e.keypoints)):console.warn("Stickman is hidden booo")},{immediate:!0})}),fe(()=>{a.forEach(s=>s.geometry.dispose())})},render(){return()=>null}});const Ve=w({props:{pose:null,position:null},setup(e){const o=e,t=N({scale:1,zMulti:.5});return $(r=>{r.name="\u{1F938} Stickman",r.add(t,"scale",.1,5,.1).name("Scale objects"),r.add(t,"zMulti",.1,2,.1).name("Z multiplier")}),(r,c)=>{const a=Re;return e.pose?(_(),V(a,{key:0,keypoints:e.pose,"z-multi":h(t).zMulti,color:16777215,scale:h(t).scale,position:o.position},null,8,["keypoints","z-multi","scale","position"])):S("",!0)}}});const $e={class:"item"},Le={key:0,class:"fas fa-check mx-1 text-green-800"},Te=w({props:{nr:null,done:null},setup(e){const o=e;return(t,r)=>(_(),v("div",$e,[e.done?(_(),v("i",Le)):S("",!0),z("div",{class:U(["flex-grow",[e.done?"line-through":"font-bold"]])},[he(t.$slots,"default")],2),z("i",{class:U([e.done?"fas":"far",`fa-circle-${o.nr}`])},null,2)]))}}),Oe=["src"],Fe=w({props:{src:null},emits:["mounted","error","loaded","timeupdated"],setup(e,{emit:o}){const t=e,r=H(),c=g();G(()=>{o("mounted",k(c))}),x(()=>t.src,()=>{const d=k(c);!d||(d.srcObject=null,o("loaded",void 0))});const a=async({target:d})=>{o("loaded",{src:t.src,duration:d.duration,width:d.videoWidth,height:d.videoHeight})},m=()=>{var d,l,i;throw r.error(`Load video error ${t.src}`),new Error((i=(l=(d=k(c))==null?void 0:d.error)==null?void 0:l.message)!=null?i:`Load error ${t.src}`)};return(d,l)=>(_(),v("video",{class:"video-border max-h-300px",ref:(i,s)=>{s.videoRef=i,c.value=i},crossorigin:"anonymous",poster:K,onLoadedmetadata:l[0]||(l[0]=(...i)=>h(a)&&h(a)(...i)),muted:""},[t.src?(_(),v("source",{key:0,onError:m,src:`${t.src}#t=0.1`},null,40,Oe)):S("",!0)],544))}}),Ie={key:0,class:"progressSteps"},Ce=M("Video in db"),je=M("Has keyframes"),De=M("Has poses"),Be=w({setup(e){const{progress:o,start:t,done:r,isLoading:c}=be();H(),ve();const a=N({src:"",showVideoTag:!0}),m=g(),d=n=>b(m,n),{currentTime:l}=pe(m),{pause:i,resume:s}=ye(l,n=>{},{immediate:!1});return i(),$(n=>{n.name="\u{1F4FC} Video Player",n.add(a,"showVideoTag").name("Show video tag"),n.addReactiveSelect({target:a,propName:"src",options:videoOptions}).name("Load video"),n.addTextInput({filter:Pe,placeholder:"blur to add"}).name("Video URL").onFinishChange(u=>{i()})}),(n,u)=>{const f=Fe,P=Te,Y=C("visible");return _(),v(W,null,[j(p(f,{controls:!h(c),src:h(a).src,onMounted:d,onLoaded:n.videoStore.replace},null,8,["controls","src","onLoaded"]),[[Y,h(a).showVideoTag]]),p(we,{name:"slide"},{default:E(()=>[n.src?(_(),v("div",Ie,[p(P,{nr:1,done:n.videoStore.hasId},{default:E(()=>[Ce]),_:1},8,["done"]),p(P,{nr:2,done:n.videoStore.hasKeyframes},{default:E(()=>[je]),_:1},8,["done"]),p(P,{nr:3,done:n.videoStore.hasPoses},{default:E(()=>[De]),_:1},8,["done"])])):S("",!0)]),_:1})],64)}}}),Ae=M("Video Display Pose"),Ge={class:"top-left"},Ue={class:"top-right"},Je=w({setup(e){const o=g(),t=a=>b(o,a),r=g(),c=a=>b(r,a);return(a,m)=>{const d=ke,l=Be,i=Ve,s=Ne;return _(),v(W,null,[p(d,null,{default:E(()=>[Ae]),_:1}),z("div",Ge,[p(l,{onPose:t}),o.value?(_(),V(i,{key:0,pose:o.value,position:[-2,0,-10]},null,8,["pose"])):S("",!0)]),z("div",Ue,[p(s,{onPose:c}),r.value?(_(),V(i,{key:0,pose:r.value,position:[2,0,-10]},null,8,["pose"])):S("",!0)])],64)}}});export{Je as default};
